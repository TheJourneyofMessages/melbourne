<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Journey of Messages</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #121212; color: rgb(250, 247, 247); }
        .neon-blue { border: 2px solid #00d2ff; box-shadow: 0 0 10px #00d2ff; }
        .neon-green { border: 2px solid #2ecc71; box-shadow: 0 0 10px #2ecc71; }
        .glass-card { background: rgba(30, 30, 30, 0.8); backdrop-filter: blur(10px); border-radius: 15px; }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 50; overflow-y: auto; }
        .modal.active { display: flex; }
        /* Mesaj yazma alanƒ± i√ßin daha a√ßƒ±k, beyaza yakƒ±n renk */
        .input-bg { background-color: #e1e8e8; color: #111827; }
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #868e9c; border-radius: 10px; }
    </style>
</head>
<body class="p-4 flex flex-col items-center min-h-screen">

    <div class="w-full max-w-md flex justify-end items-center mb-4">
        <select id="lang-select" class="bg-gray-800 text-xs p-2 rounded-lg border border-gray-700 focus:outline-none focus:ring-1 focus:ring-cyan-500 cursor-pointer">
            <option value="ar">Arabic</option>
            <option value="zh">Chinese</option>
            <option value="en" selected>English</option>
            <option value="fa">Farsi</option>
            <option value="fr">French</option>
            <option value="de">German</option>
            <option value="el">Greek</option>
            <option value="hi">Hindi</option>
            <option value="id">Indonesian</option>
            <option value="it">Italian</option>
            <option value="ja">Japanese</option>
            <option value="ko">Korean</option>
            <option value="pt">Portuguese</option>
            <option value="pa">Punjabi</option>
            <option value="ru">Russian</option>
            <option value="es">Spanish</option>
            <option value="tl">Tagalog</option>
            <option value="th">Thai</option>
            <option value="tr">Turkish</option>
            <option value="vi">Vietnamese</option>
        </select>
    </div>

    <div class="w-full max-w-md text-center mb-8">
        <a href="https://thejourneyofmessages.github.io/melbourne/" target="_blank" class="inline-block">
            <h1 id="ui-title" class="text-3xl font-extrabold tracking-tight text-cyan-400 mb-1 hover:scale-105 transition-transform cursor-pointer">
                The Journey of Messages
            </h1>
        </a>
        <div class="text-4xl mb-3 text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-500">üö¥</div>
        <p id="ui-subtitle" class="text-gray-400 text-sm leading-relaxed px-2">
            The last person who scanned this QR left a message for you, and now it's your turn to leave a message for the next person.
        </p>
    </div>

    <div class="w-full max-w-md glass-card neon-blue p-6 mb-4">
        <p id="ui-prev-label" class="text-blue-400 text-[10px] font-bold uppercase tracking-widest mb-2">A Stranger Before You Left This:</p>
        <div id="latest-msg-box" class="italic text-lg text-gray-100 leading-relaxed">"..."</div>
        <div id="latest-author" class="text-[10px] text-gray-500 mt-4 uppercase tracking-tighter">‚Äî Loading...</div>
    </div>

    <div class="w-full max-w-md glass-card neon-green p-6 mb-6">
        <div class="mb-4">
            <label id="ui-nick-label" class="block text-green-400 text-[10px] font-bold uppercase mb-1 tracking-wider">Nickname</label>
            <input id="user-name" type="text" class="w-full input-bg border-b-2 border-gray-300 p-3 rounded-t-lg focus:outline-none transition-colors shadow-inner font-bold text-base">
        </div>
        <div>
            <label id="ui-msg-label" class="block text-green-400 text-[10px] font-bold uppercase mb-1 tracking-wider">Your Message</label>
            <textarea id="user-msg" rows="3" class="w-full input-bg rounded-b-lg p-3 focus:outline-none transition-all shadow-inner font-medium text-base"></textarea>
        </div>
    </div>

    <div class="w-full max-w-md flex flex-col gap-4">
        <button id="send-btn" class="w-full bg-cyan-500 hover:bg-cyan-600 text-white font-extrabold py-4 rounded-2xl transition-all shadow-lg active:scale-95">SEND MESSAGE</button>
        <button id="view-btn" class="w-full bg-gray-800 hover:bg-gray-700 text-white font-bold py-4 rounded-2xl transition-all active:scale-95 border border-gray-700">VIEW ALL MESSAGES</button>
    </div>

    <div id="msg-modal" class="modal items-start justify-center p-4">
        <div class="w-full max-w-md glass-card p-6 my-8 relative border border-gray-700">
            <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-white text-3xl">&times;</button>
            <h2 id="ui-modal-title" class="text-2xl font-bold mb-6 text-cyan-400">The Melbourne Message Box</h2>
            <div id="messages-list" class="space-y-4 max-h-[50vh] overflow-y-auto pr-2 custom-scrollbar"></div>
            
            <div class="mt-10 pt-6 border-t border-gray-800 text-center">
                <p id="ui-coffee-text" class="text-sm text-gray-400 mb-6 italic">‚ÄúA coffee would be a great companion on the journey of these messages ‚òï‚Äù‚õ∞Ô∏è</p>
                <a href="https://www.buymeacoffee.com/melbournemessagebox" target="_blank" class="inline-block bg-[#FFDD00] text-black font-extrabold py-3 px-10 rounded-full shadow-xl transition transform hover:scale-105">
                    Shout me a Coffee ‚òï
                </a>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, query, orderBy, limit, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDIh-tPQeW43foZ3XyMUdjfO1xdxAH3nes",
            authDomain: "melbourne-mystery.firebaseapp.com",
            projectId: "melbourne-mystery",
            storageBucket: "melbourne-mystery.firebasestorage.app",
            messagingSenderId: "1056596554109",
            appId: "1:1056596554109:web:b9d198d7e4762ebbc65c14",
            measurementId: "G-1X4XTXZN3V"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const colRef = collection(db, "messages");

        // Zaman Formatlama
        const formatDate = (ts) => {
            if(!ts) return "Just now";
            const date = ts.toDate();
            return date.toLocaleDateString('en-GB', { day: 'numeric', month: 'short' }) + " " + 
                   date.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
        };

        // S√∂zl√ºk (Arap√ßa, √áince, T√ºrk√ße, Korece, Japonca √ñrnekli)
// 20 Dƒ∞Lƒ∞N TAM √áEVƒ∞Rƒ∞Sƒ∞ - REƒ∞S PAKETƒ∞
        const i18n = {
            en: { title: "The Journey of Messages", subtitle: "The last person who scanned this QR left a message for you, and now it's your turn to leave a message for the next person.", prev: "A Stranger Before You Left This:", nick: "Nickname", msg: "Your Message", send: "SEND MESSAGE", view: "VIEW ALL MESSAGES", modal: "The Melbourne Message Box", coffee: "A coffee would be a great companion on the journey of these messages ‚òï", bag: "Message in the bag! Ride continues. üö≤" },
            tr: { title: "Mesajlarƒ±n Yolculuƒüu", subtitle: "Bu QR kodu okutan son ki≈üi sana bir mesaj bƒ±raktƒ±; ≈üimdi sƒ±ra sende, sƒ±radaki ki≈üi i√ßin bir mesaj bƒ±rak.", prev: "Senden √ñnceki Yabancƒ± ≈ûunu Bƒ±raktƒ±:", nick: "Takma Ad", msg: "Mesajƒ±n", send: "MESAJI G√ñNDER", view: "T√úM MESAJLARI G√ñR", modal: "K√ºresel Mesaj Zinciri", coffee: "Ben yoku≈ülarƒ± senin yerine √ßƒ±kƒ±yorum. Efsaneye yakƒ±t? ‚òï‚õ∞Ô∏è", bag: "Mesaj √ßantada! Yolculuk devam ediyor. üö≤" },
            zh: { title: "Ê∂àÊÅØ‰πãÊóÖ", subtitle: "Êâ´ÊèèÊ≠§‰∫åÁª¥Á†ÅÁöÑÊúÄÂêé‰∏Ä‰∏™‰∫∫Áªô‰Ω†Áïô‰∏ã‰∫Ü‰ø°ÊÅØÔºåÁé∞Âú®ËΩÆÂà∞‰Ω†Áªô‰∏ã‰∏Ä‰∏™‰∫∫Áïô‰ø°ÊÅØ‰∫Ü„ÄÇ", prev: "Âú®‰Ω†‰πãÂâçÁöÑÈôåÁîü‰∫∫Áïô‰∏ã‰∫ÜËøô‰∏™Ôºö", nick: "ÊòµÁß∞", msg: "‰Ω†ÁöÑÁïôË®Ä", send: "ÂèëÈÄÅÊ∂àÊÅØ", view: "Êü•ÁúãÊâÄÊúâÊ∂àÊÅØ", modal: "ÂÖ®ÁêÉÊ∂àÊÅØÈìæ", coffee: "ÊàëÂú®‰∏∫‰Ω†Áà¨Âù°„ÄÇÁªô‰º†Â•áÂä†ÁÇπÊ≤πÔºü ‚òï‚õ∞Ô∏è", bag: "Ê∂àÊÅØÂ∑≤Ë£ÖË¢ãÔºÅÈ™ëË°åÁªßÁª≠„ÄÇüö≤" },
            ko: { title: "Î©îÏãúÏßÄÏùò Ïó¨Ï†ï", subtitle: "Ïù¥ QRÏùÑ Ïä§Ï∫îÌïú ÎßàÏßÄÎßâ ÏÇ¨ÎûåÏù¥ ÎãπÏã†ÏóêÍ≤å Î©îÏãúÏßÄÎ•º ÎÇ®Í≤ºÍ≥†, Ïù¥Ï†ú Îã§Ïùå ÏÇ¨ÎûåÏóêÍ≤å Î©îÏãúÏßÄÎ•º ÎÇ®Í∏∏ Ï∞®Î°ÄÏûÖÎãàÎã§.", prev: "Ïù¥Ï†Ñ ÏÇ¨ÎûåÏù¥ Î©îÏãúÏßÄÎ•º ÎÇ®Í≤ºÏäµÎãàÎã§:", nick: "ÎãâÎÑ§ÏûÑ", msg: "Î©îÏãúÏßÄ", send: "Î©îÏãúÏßÄ Î≥¥ÎÇ¥Í∏∞", view: "Ï†ÑÏ≤¥ Î≥¥Í∏∞", modal: "Î©îÏãúÏßÄ Ï≤¥Ïù∏", coffee: "ÎãπÏã†ÏùÑ ÏúÑÌï¥ Ïñ∏ÎçïÏùÑ Ïò§Î•¥Í≥† ÏûàÏäµÎãàÎã§. Ï†ÑÏÑ§ÏùÑ ÏùëÏõêÌï¥Ï£ºÏÑ∏Ïöî? ‚òï‚õ∞Ô∏è", bag: "Î©îÏãúÏßÄ ÏôÑÎ£å! üö≤" },
            ja: { title: "„É°„ÉÉ„Çª„Éº„Ç∏„ÅÆÊóÖ", subtitle: "„Åì„ÅÆQR„Ç≥„Éº„Éâ„Çí„Çπ„Ç≠„É£„É≥„Åó„ÅüÊúÄÂæå„ÅÆ‰∫∫„Åå„ÅÇ„Å™„Åü„Å´„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÊÆã„Åó„Åæ„Åó„Åü„ÄÇ‰ªäÂ∫¶„ÅØ„ÅÇ„Å™„Åü„ÅåÊ¨°„ÅÆ‰∫∫„Å´„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÊÆã„ÅôÁï™„Åß„Åô„ÄÇ", prev: "Ââç„ÅÆ‰∫∫„ÅåÊÆã„Åó„Åü„É°„ÉÉ„Çª„Éº„Ç∏Ôºö", nick: "„Éã„ÉÉ„ÇØ„Éç„Éº„É†", msg: "„É°„ÉÉ„Çª„Éº„Ç∏", send: "ÈÄÅ‰ø°„Åô„Çã", view: "„Åô„Åπ„Å¶Ë¶ã„Çã", modal: "„É°„ÉÉ„Çª„Éº„Ç∏„ÉÅ„Çß„Éº„É≥", coffee: "„ÅÇ„Å™„Åü„ÅÆ‰ª£„Çè„Çä„Å´ÂùÇ„ÇíÊºï„ÅÑ„Åß„ÅÑ„Åæ„Åô„ÄÇ‰ºùË™¨„Å´ÁáÉÊñô„ÇíÔºü ‚òï‚õ∞Ô∏è", bag: "„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂèó„ÅëÂèñ„Çä„Åæ„Åó„ÅüÔºÅüö≤" },
            ar: { title: "ÿ±ÿ≠ŸÑÿ© ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ", subtitle: "ÿßŸÑÿ¥ÿÆÿµ ÿßŸÑÿ£ÿÆŸäÿ± ÿßŸÑÿ∞Ÿä ŸÖÿ≥ÿ≠ ÿ±ŸÖÿ≤ ÿßŸÑÿßÿ≥ÿ™ÿ¨ÿßÿ®ÿ© ÿßŸÑÿ≥ÿ±Ÿäÿπÿ© Ÿáÿ∞ÿß ÿ™ÿ±ŸÉ ÿ±ÿ≥ÿßŸÑÿ© ŸÑŸÉÿå ŸàÿßŸÑÿ¢ŸÜ ÿ≠ÿßŸÜ ÿØŸàÿ±ŸÉ ŸÑÿ™ÿ±ŸÉ ÿ±ÿ≥ÿßŸÑÿ© ŸÑŸÑÿ¥ÿÆÿµ ÿßŸÑÿ™ÿßŸÑŸä.", prev: "ÿ™ÿ±ŸÉ ŸÑŸÉ ÿßŸÑÿ¥ÿÆÿµ ÿßŸÑÿ≥ÿßÿ®ŸÇ ÿ±ÿ≥ÿßŸÑÿ©:", nick: "ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿπÿßÿ±", msg: "ÿ±ÿ≥ÿßŸÑÿ™ŸÉ", send: "ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©", view: "ÿπÿ±ÿ∂ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ", modal: "ÿ≥ŸÑÿ≥ŸÑÿ© ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿπÿßŸÑŸÖŸäÿ©", coffee: "ÿ£ŸÜÿß ÿ£ŸÇŸàÿØ ÿßŸÑÿØÿ±ÿßÿ¨ÿ© ŸÅŸä ÿßŸÑŸÖÿ±ÿ™ŸÅÿπÿßÿ™ ŸÖŸÜ ÿ£ÿ¨ŸÑŸÉ. ŸáŸÑ ÿ™ÿØÿπŸÖ ÿßŸÑÿ£ÿ≥ÿ∑Ÿàÿ±ÿ©ÿü ‚òï‚õ∞Ô∏è", bag: "ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ŸÅŸä ÿßŸÑÿ≠ŸÇŸäÿ®ÿ©! ÿßŸÑÿ±ÿ≠ŸÑÿ© ÿ™ÿ≥ÿ™ŸÖÿ±. üö≤" },
            hi: { title: "‡§∏‡§Ç‡§¶‡•á‡§∂‡•ã‡§Ç ‡§ï‡•Ä ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ", subtitle: "‡§á‡§∏ QR ‡§ï‡•ã ‡§∏‡•ç‡§ï‡•à‡§® ‡§ï‡§∞‡§®‡•á ‡§µ‡§æ‡§≤‡•á ‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø ‡§®‡•á ‡§Ü‡§™‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§õ‡•ã‡§°‡§º‡§æ ‡§π‡•à, ‡§î‡§∞ ‡§Ö‡§¨ ‡§Ö‡§ó‡§≤‡•á ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§õ‡•ã‡§°‡§º‡§®‡•á ‡§ï‡•Ä ‡§Ü‡§™‡§ï‡•Ä ‡§¨‡§æ‡§∞‡•Ä ‡§π‡•à‡•§", prev: "‡§™‡§ø‡§õ‡§≤‡•á ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø ‡§®‡•á ‡§Ü‡§™‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§õ‡•ã‡§°‡§º‡§æ ‡§π‡•à:", nick: "‡§â‡§™‡§®‡§æ‡§Æ", msg: "‡§Ü‡§™‡§ï‡§æ ‡§∏‡§Ç‡§¶‡•á‡§∂", send: "‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§≠‡•á‡§ú‡•á‡§Ç", view: "‡§∏‡§≠‡•Ä ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§¶‡•á‡§ñ‡•á‡§Ç", modal: "‡§µ‡•à‡§∂‡•ç‡§µ‡§ø‡§ï ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§∂‡•ç‡§∞‡•É‡§Ç‡§ñ‡§≤‡§æ", coffee: "‡§Æ‡•à‡§Ç ‡§™‡§π‡§æ‡§°‡§º‡§ø‡§Ø‡•ã‡§Ç ‡§™‡§∞ ‡§™‡•à‡§°‡§≤ ‡§Æ‡§æ‡§∞ ‡§∞‡§π‡§æ ‡§π‡•Ç‡§Å ‡§§‡§æ‡§ï‡§ø ‡§Ü‡§™‡§ï‡•ã ‡§® ‡§ï‡§∞‡§®‡§æ ‡§™‡§°‡§º‡•á‡•§ ‡§≤‡•Ä‡§ú‡•á‡§Ç‡§° ‡§ï‡§æ ‡§∏‡§Æ‡§∞‡•ç‡§•‡§® ‡§ï‡§∞‡•á‡§Ç? ‚òï‚õ∞Ô∏è", bag: "‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§¨‡•à‡§ó ‡§Æ‡•á‡§Ç ‡§π‡•à! ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§ú‡§æ‡§∞‡•Ä ‡§π‡•à‡•§ üö≤" },
            es: { title: "El Viaje de los Mensajes", subtitle: "La √∫ltima persona que escane√≥ este c√≥digo QR te dej√≥ un mensaje, y ahora es tu turno de dejar un mensaje para la siguiente persona.", prev: "Alguien dej√≥ esto para ti:", nick: "Apodo", msg: "Tu Mensaje", send: "ENVIAR MENSAJE", view: "VER TODOS", modal: "Cadena de Mensajes", coffee: "Pedaleo por las colinas por ti. ¬øApoyas al leyenda? ‚òï‚õ∞Ô∏è", bag: "¬°Mensaje enviado! üö≤" },
            fr: { title: "Le Voyage des Messages", subtitle: "La derni√®re personne qui a scann√© ce QR a laiss√© un message pour vous, et c'est maintenant √† votre tour de laisser un message pour la prochaine personne.", prev: "Un inconnu a laiss√© ceci pour vous:", nick: "Surnom", msg: "Votre Message", send: "ENVOYER", view: "VOIR TOUT", modal: "Cha√Æne Globale", coffee: "Je p√©dale pour vous. Un petit caf√© pour la l√©gende ? ‚òï‚õ∞Ô∏è", bag: "Message en poche ! üö≤" },
            de: { title: "Die Reise der Nachrichten", subtitle: "Die letzte Person, die diesen QR-Code gescannt hat, hat eine Nachricht f√ºr dich hinterlassen, und jetzt bist du an der Reihe, eine Nachricht f√ºr die n√§chste Person zu hinterlassen.", prev: "Jemand hat dies f√ºr dich hinterlassen:", nick: "Spitzname", msg: "Deine Nachricht", send: "SENDEN", view: "ALLE SEHEN", modal: "Nachrichtenkette", coffee: "Ich strample f√ºr dich die Berge hoch. Kaffee f√ºr die Legende? ‚òï‚õ∞Ô∏è", bag: "Nachricht ist im Sack! üö≤" },
            it: { title: "Il Viaggio dei Messaggi", subtitle: "L'ultima persona che ha scansionato questo QR ha lasciato un messaggio per te, e ora √® il tuo turno di lasciare un messaggio per la prossima persona.", prev: "Uno sconosciuto ha lasciato questo per te:", nick: "Soprannome", msg: "Il tuo Messaggio", send: "INVIA", view: "VEDI TUTTI", modal: "Catena di Messaggi", coffee: "Pedalo in salita per te. Caff√® per la leggenda? ‚òï‚õ∞Ô∏è", bag: "Messaggio in borsa! üö≤" },
            vi: { title: "H√†nh tr√¨nh c·ªßa nh·ªØng th√¥ng ƒëi·ªáp", subtitle: "Ng∆∞·ªùi cu·ªëi c√πng qu√©t m√£ QR n√†y ƒë√£ ƒë·ªÉ l·∫°i tin nh·∫Øn cho b·∫°n, v√† gi·ªù ƒë·∫øn l∆∞·ª£t b·∫°n ƒë·ªÉ l·∫°i tin nh·∫Øn cho ng∆∞·ªùi ti·∫øp theo.", prev: "Ng∆∞·ªùi tr∆∞·ªõc ƒë√≥ ƒë√£ ƒë·ªÉ l·∫°i l·ªùi nh·∫Øn:", nick: "Bi·ªát danh", msg: "Tin nh·∫Øn c·ªßa b·∫°n", send: "G·ª¨I TIN NH·∫ÆN", view: "XEM T·∫§T C·∫¢", modal: "Chu·ªói tin nh·∫Øn", coffee: "T√¥i ƒëang ƒë·∫°p xe leo d·ªëc thay b·∫°n. ·ª¶ng h·ªô huy·ªÅn tho·∫°i ch·ª©? ‚òï‚õ∞Ô∏è", bag: "ƒê√£ nh·∫≠n tin nh·∫Øn! üö≤" },
            ru: { title: "–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π", subtitle: "–ü–æ—Å–ª–µ–¥–Ω–∏–π —á–µ–ª–æ–≤–µ–∫, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–ª —ç—Ç–æ—Ç QR-–∫–æ–¥, –æ—Å—Ç–∞–≤–∏–ª –¥–ª—è –≤–∞—Å —Å–æ–æ–±—â–µ–Ω–∏–µ, –∏ —Ç–µ–ø–µ—Ä—å –≤–∞—à–∞ –æ—á–µ—Ä–µ–¥—å –æ—Å—Ç–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞.", prev: "–ö—Ç–æ-—Ç–æ –æ—Å—Ç–∞–≤–∏–ª —ç—Ç–æ –¥–ª—è –≤–∞—Å:", nick: "–ù–∏–∫–Ω–µ–π–º", msg: "–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ", send: "–û–¢–ü–†–ê–í–ò–¢–¨", view: "–ü–û–°–ú–û–¢–†–ï–¢–¨ –í–°–ï", modal: "–¶–µ–ø–æ—á–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π", coffee: "–Ø –∫—Ä—É—á—É –ø–µ–¥–∞–ª–∏ –∑–∞ –≤–∞—Å. –ö–æ—Ñ–µ –¥–ª—è –ª–µ–≥–µ–Ω–¥—ã? ‚òï‚õ∞Ô∏è", bag: "–°–æ–æ–±—â–µ–Ω–∏–µ –≤ —Å—É–º–∫–µ! üö≤" },
            pt: { title: "A Jornada das Mensagens", subtitle: "A √∫ltima pessoa que escaneou este QR deixou uma mensagem para voc√™, e agora √© sua vez de deixar uma mensagem para a pr√≥xima pessoa.", prev: "Algu√©m deixou isso para voc√™:", nick: "Apelido", msg: "Sua Mensagem", send: "ENVIAR", view: "VER TODOS", modal: "Corrente de Mensagens", coffee: "Pedalo por voc√™. Caf√© para a lenda? ‚òï‚õ∞Ô∏è", bag: "Mensagem enviada! üö≤" },
            id: { title: "Perjalanan Pesan", subtitle: "Orang terakhir yang memindai QR ini meninggalkan pesan untukmu, dan sekarang giliranmu untuk meninggalkan pesan untuk orang berikutnya.", prev: "Seseorang meninggalkan ini untukmu:", nick: "Nama Panggilan", msg: "Pesanmu", send: "KIRIM PESAN", view: "LIHAT SEMUA", modal: "Rantai Pesan", coffee: "Saya mengayuh tanjakan untukmu. Dukung sang legenda? ‚òï‚õ∞Ô∏è", bag: "Pesan terkirim! üö≤" },
            th: { title: "‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°", subtitle: "‡∏Ñ‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏™‡πÅ‡∏Å‡∏ô QR ‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡∏ù‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì ‡πÅ‡∏•‡∏∞‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏ñ‡∏∂‡∏á‡∏ï‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ù‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ", prev: "‡∏°‡∏µ‡∏Ñ‡∏ô‡∏ù‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì:", nick: "‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô", msg: "‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì", send: "‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°", view: "‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î", modal: "‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÇ‡∏•‡∏Å", coffee: "‡∏â‡∏±‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏±‡πà‡∏ô‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏Ç‡∏≤‡πÅ‡∏ó‡∏ô‡∏Ñ‡∏∏‡∏ì ‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏Å‡∏≤‡πÅ‡∏ü‡∏ï‡∏≥‡∏ô‡∏≤‡∏ô‡∏´‡∏ô‡πà‡∏≠‡∏¢‡πÑ‡∏´‡∏°? ‚òï‚õ∞Ô∏è", bag: "‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡πâ‡∏ß! üö≤" },
            tl: { title: "Ang Paglalakbay ng mga Mensahe", subtitle: "Ang huling taong nag-scan ng QR code na ito ay nag-iwan ng mensahe para sa iyo, at ngayon ay ikaw naman ang mag-iiwan ng mensahe para sa susunod na tao.", prev: "May nag-iwan nito para sa iyo:", nick: "Palayaw", msg: "Iyong Mensahe", send: "IPADALA", view: "TINGNAN LAHAT", modal: "Global Message Chain", coffee: "Nagpe-pedal ako para sa iyo. Kape para sa alamat? ‚òï‚õ∞Ô∏è", bag: "Mensahe ay nasa bag na! üö≤" },
            fa: { title: "ÿ≥ŸÅÿ± Ÿæ€åÿßŸÖ‚ÄåŸáÿß", subtitle: "ÿ¢ÿÆÿ±€åŸÜ ⁄©ÿ≥€å ⁄©Ÿá ÿß€åŸÜ QR ÿ±ÿß ÿßÿ≥⁄©ŸÜ ⁄©ÿ±ÿØ Ÿæ€åÿßŸÖ€å ÿ®ÿ±ÿß€å ÿ¥ŸÖÿß ⁄Øÿ∞ÿßÿ¥ÿ™ÿå Ÿà ÿ≠ÿßŸÑÿß ŸÜŸàÿ®ÿ™ ÿ¥ŸÖÿßÿ≥ÿ™ ⁄©Ÿá Ÿæ€åÿßŸÖ€å ÿ®ÿ±ÿß€å ŸÜŸÅÿ± ÿ®ÿπÿØ€å ÿ®⁄Øÿ∞ÿßÿ±€åÿØ.", prev: "€å⁄© ÿ∫ÿ±€åÿ®Ÿá ÿß€åŸÜ ÿ±ÿß ÿ®ÿ±ÿß€å ÿ¥ŸÖÿß ⁄Øÿ∞ÿßÿ¥ÿ™Ÿá:", nick: "ŸÜÿßŸÖ ŸÖÿ≥ÿ™ÿπÿßÿ±", msg: "Ÿæ€åÿßŸÖ ÿ¥ŸÖÿß", send: "ÿßÿ±ÿ≥ÿßŸÑ Ÿæ€åÿßŸÖ", view: "ŸÖÿ¥ÿßŸáÿØŸá ŸáŸÖŸá", modal: "ÿ≤ŸÜÿ¨€åÿ±Ÿá Ÿæ€åÿßŸÖ‚ÄåŸáÿß", coffee: "ŸÖŸÜ ÿ®Ÿá ÿ¨ÿß€å ÿ¥ŸÖÿß Ÿæÿß ŸÖ€å‚Äåÿ≤ŸÜŸÖ. ŸÇŸáŸàŸá ÿ®ÿ±ÿß€å ÿßÿ≥ÿ∑Ÿàÿ±Ÿáÿü ‚òï‚õ∞Ô∏è", bag: "Ÿæ€åÿßŸÖ ÿßÿ±ÿ≥ÿßŸÑ ÿ¥ÿØ! üö≤" },
            pa: { title: "‡®∏‡©Å‡®®‡©á‡®π‡®ø‡®Ü‡®Ç ‡®¶‡©Ä ‡®Ø‡®æ‡®§‡®∞‡®æ", subtitle: "‡®á‡®∏ QR ‡®ï‡©ã‡®° ‡®®‡©Ç‡©∞ ‡®∏‡®ï‡©à‡®® ‡®ï‡®∞‡®® ‡®µ‡®æ‡®≤‡©á ‡®Ü‡®ñ‡®∞‡©Ä ‡®µ‡®ø‡®Ö‡®ï‡®§‡©Ä ‡®®‡©á ‡®§‡©Å‡®π‡®æ‡®°‡©á ‡®≤‡®à ‡®∏‡©Å‡®®‡©á‡®π‡®æ ‡®õ‡©±‡®°‡®ø‡®Ü ‡®π‡©à, ‡®Ö‡®§‡©á ‡®π‡©Å‡®£ ‡®§‡©Å‡®π‡®æ‡®°‡©Ä ‡®µ‡®æ‡®∞‡©Ä ‡®π‡©à ‡®Ö‡®ó‡®≤‡©á ‡®µ‡®ø‡®Ö‡®ï‡®§‡©Ä ‡®≤‡®à ‡®∏‡©Å‡®®‡©á‡®π‡®æ ‡®õ‡©±‡®°‡®£ ‡®¶‡©Ä‡•§", prev: "‡®™‡®ø‡®õ‡®≤‡©á ‡®µ‡®ø‡®Ö‡®ï‡®§‡©Ä ‡®®‡©á ‡®§‡©Å‡®π‡®æ‡®°‡©á ‡®≤‡®à ‡®á‡®π ‡®õ‡©±‡®°‡®ø‡®Ü ‡®π‡©à:", nick: "‡®â‡®™‡®®‡®æ‡®Æ", msg: "‡®§‡©Å‡®π‡®æ‡®°‡®æ ‡®∏‡©Å‡®®‡©á‡®π‡®æ", send: "‡®∏‡©Å‡®®‡©á‡®π‡®æ ‡®≠‡©á‡®ú‡©ã", view: "‡®∏‡®æ‡®∞‡©á ‡®¶‡©á‡®ñ‡©ã", modal: "‡®∏‡©Å‡®®‡©á‡®π‡®æ ‡®ö‡©á‡®®", coffee: "‡®Æ‡©à‡®Ç ‡®§‡©Å‡®π‡®æ‡®°‡©á ‡®≤‡®à ‡®™‡©à‡®°‡®≤ ‡®Æ‡®æ‡®∞ ‡®∞‡®ø‡®π‡®æ ‡®π‡®æ‡®Ç‡•§ ‡®ï‡©å‡®´‡©Ä ‡®™‡®ø‡®≤‡®æ‡®ì‡®ó‡©á? ‚òï‚õ∞Ô∏è", bag: "‡®∏‡©Å‡®®‡©á‡®π‡®æ ‡®Æ‡®ø‡®≤ ‡®ó‡®ø‡®Ü! üö≤" },
            el: { title: "Œ§Œø Œ§Œ±ŒæŒØŒ¥Œπ œÑœâŒΩ ŒúŒ∑ŒΩœÖŒºŒ¨œÑœâŒΩ", subtitle: "Œ§Œø œÑŒµŒªŒµœÖœÑŒ±ŒØŒø Œ¨œÑŒøŒºŒø œÄŒøœÖ œÉŒ¨œÅœâœÉŒµ Œ±œÖœÑœåŒΩ œÑŒøŒΩ Œ∫œâŒ¥ŒπŒ∫œå QR Œ¨œÜŒ∑œÉŒµ Œ≠ŒΩŒ± ŒºŒÆŒΩœÖŒºŒ± Œ≥ŒπŒ± ŒµœÉŒ¨œÇ, Œ∫Œ±Œπ œÑœéœÅŒ± ŒµŒØŒΩŒ±Œπ Œ∑ œÉŒµŒπœÅŒ¨ œÉŒ±œÇ ŒΩŒ± Œ±œÜŒÆœÉŒµœÑŒµ Œ≠ŒΩŒ± ŒºŒÆŒΩœÖŒºŒ± Œ≥ŒπŒ± œÑŒø ŒµœÄœåŒºŒµŒΩŒø Œ¨œÑŒøŒºŒø.", prev: "ŒöŒ¨œÄŒøŒπŒøœÇ Œ¨œÜŒ∑œÉŒµ Œ±œÖœÑœå Œ≥ŒπŒ± ŒµœÉŒ¨œÇ:", nick: "ŒåŒΩŒøŒºŒ±", msg: "Œ§Œø ŒºŒÆŒΩœÖŒºŒ¨ œÉŒ±œÇ", send: "ŒëŒ†ŒüŒ£Œ§ŒüŒõŒó", view: "ŒüŒõŒë Œ§Œë ŒúŒóŒùŒ•ŒúŒëŒ§Œë", modal: "Œ†Œ±Œ≥Œ∫œåœÉŒºŒπŒ± ŒëŒªœÖœÉŒØŒ¥Œ±", coffee: "ŒöŒ¨ŒΩœâ œÄŒµŒΩœÑŒ¨Œª Œ≥ŒπŒ± ŒµœÉŒ¨œÇ. ŒöŒ±œÜŒ≠ Œ≥ŒπŒ± œÑŒøŒΩ Œ∏œÅœçŒªŒø; ‚òï‚õ∞Ô∏è", bag: "Œ§Œø ŒºŒÆŒΩœÖŒºŒ± ŒµœÉœÑŒ¨ŒªŒ∑! üö≤" }
        };

const updateUI = (lang) => {
    const t = i18n[lang] || i18n.en; // Eƒüer dil bulunamazsa ƒ∞ngilizceye d√∂ner
    
    // Her bir ID'yi tek tek s√∂zl√ºkteki kar≈üƒ±lƒ±ƒüƒ±na baƒülƒ±yoruz
    if(document.getElementById('ui-title')) document.getElementById('ui-title').innerText = t.title;
    if(document.getElementById('ui-subtitle')) document.getElementById('ui-subtitle').innerText = t.subtitle;
    if(document.getElementById('ui-prev-label')) document.getElementById('ui-prev-label').innerText = t.prev;
    if(document.getElementById('ui-nick-label')) document.getElementById('ui-nick-label').innerText = t.nick;
    if(document.getElementById('ui-msg-label')) document.getElementById('ui-msg-label').innerText = t.msg;
    if(document.getElementById('send-btn')) document.getElementById('send-btn').innerText = t.send;
    if(document.getElementById('view-btn')) document.getElementById('view-btn').innerText = t.view;
    if(document.getElementById('ui-modal-title')) document.getElementById('ui-modal-title').innerText = t.modal;
    if(document.getElementById('ui-coffee-text')) document.getElementById('ui-coffee-text').innerText = t.coffee;
    
    // Uyarƒ± mesajƒ±nƒ± global deƒüi≈ükene atƒ±yoruz
    window.currentBagMsg = t.bag;
};

        document.getElementById('lang-select').onchange = (e) => updateUI(e.target.value);
        updateUI('en');

        // Son Mesaj
        onSnapshot(query(colRef, orderBy("timestamp", "desc"), limit(1)), (snap) => {
            if(!snap.empty) {
                const data = snap.docs[0].data();
                document.getElementById('latest-msg-box').innerText = `"${data.message}"`;
                document.getElementById('latest-author').innerText = `‚Äî ${data.name || 'Someone'} ‚Ä¢ ${formatDate(data.timestamp)}`;
            }
        });

        // Mesaj g√∂nderim kontrol√º i√ßin flag
        let hasSubmittedMessage = localStorage.getItem('hasSubmittedMessage') === 'true';

        // Mesaj G√∂nder
        document.getElementById('send-btn').onclick = async () => {
            const name = document.getElementById('user-name').value;
            const message = document.getElementById('user-msg').value;
            if(!message.trim()) return;
            await addDoc(colRef, { name: name || "Anonymous", message, timestamp: serverTimestamp() });
            document.getElementById('user-msg').value = "";
            document.getElementById('user-name').value = "";
            
            // Mesaj g√∂nderildi flag'ini ayarla
            hasSubmittedMessage = true;
            localStorage.setItem('hasSubmittedMessage', 'true');
            
            alert(window.currentBagMsg);
        };

        window.closeModal = () => document.getElementById('msg-modal').classList.remove('active');
        document.getElementById('view-btn').onclick = () => {
            // √ñnce mesaj g√∂nderilip g√∂nderilmediƒüini kontrol et
            if (!hasSubmittedMessage) {
                alert('Please leave a message first before viewing all messages! üìù');
                return;
            }
            
            document.getElementById('msg-modal').classList.add('active');
            
            // Coffee Legends koleksiyonunu y√ºkle
            const coffeesRef = collection(db, "coffees");
            onSnapshot(query(coffeesRef, orderBy("timestamp", "desc")), (coffeeSnap) => {
                const list = document.getElementById('messages-list');
                let coffeeLegends = '';
                
                // Coffee Legends b√∂l√ºm√ºn√º hazƒ±rla
                if (!coffeeSnap.empty) {
                    const coffeeNames = coffeeSnap.docs.map(doc => doc.data().name).filter(n => n);
                    if (coffeeNames.length > 0) {
                        coffeeLegends = `
                            <div class="bg-gradient-to-r from-cyan-500/0 to-blue-500/10 border-2 border-cyan-500 rounded-2xl p-6 mt-6">
                                <h3 class="text-cyan-400 font-extrabold text-lg mb-4 flex items-center gap-2">
                                    ‚òï Coffee Legends
                                </h3>
                                <div class="flex flex-wrap gap-3">
                                    ${coffeeNames.map(name => `<span class="text-cyan-300 text-sm font-semibold">‚≠ê ${name}</span>`).join('')}
                                </div>
                            </div>
                        `;
                    }
                }
                
                // Mesajlarƒ± y√ºkle (√∂nce mesajlar, sonra Coffee Legends)
                onSnapshot(query(colRef, orderBy("timestamp", "desc")), (snap) => {
                    const messagesHtml = snap.docs.map(doc => `
                        <div class="bg-gray-900/80 p-4 rounded-xl border border-gray-700">
                            <p class="text-sm text-gray-100 italic">"${doc.data().message}"</p>
                            <p class="text-[10px] text-gray-500 mt-2 font-bold uppercase tracking-tighter">
                                ${doc.data().name || 'Anonymous'} ‚Ä¢ ${formatDate(doc.data().timestamp)}
                            </p>
                        </div>
                    `).join('');
                    
                    list.innerHTML = messagesHtml + coffeeLegends;
                });
            });
        };
    </script>
</body>
</html>